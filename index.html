<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Bank Game</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Create 5-letter words from your daily letter bank">
    <meta name="theme-color" content="#7c3aed">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIldvcmQgQmFuayBHYW1lIiwKICAic2hvcnRfbmFtZSI6ICJXb3JkQmFuayIsCiAgImRlc2NyaXB0aW9uIjogIkNyZWF0ZSA1LWxldHRlciB3b3JkcyBmcm9tIHlvdXIgZGFpbHkgbGV0dGVyIGJhbmsiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzdjM2FlZCIsCiAgInRoZW1lX2NvbG9yIjogIiM3YzNhZWQiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1URXlJaUJvWldsbmFIUTlJakV5TWlJZ2RtbGxkMEp2ZUQwaU1DQXdJREV5TWlBeE1qSWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQR05wY21Oc1pTQmplRDBpTmpFaUlHTjVQU0kyTVNJZ2NqMGlOREVpSUdacGJHdzlJaU01TWpBMVFVWWlMejQ4Y0dGMGFDQmtQU0p0TkRFc01qRmhNakFzTWpBZ01DQXRNVFFZTVRGME1uWmhNakFzTWpBZ01DQXdMVEUwWXpBdE16TXVNREV5TFRJMkxqazROQzAwT0RsQk1qZGhNekFzTXpBZ01DQXdMVEUyTFRFMmRqbGhNVFlzTVRaZ01DQXdMVEU0TFRFNFZqUmhNekFzTXpBZ01DQXdMVEUyTFRFMmVpSWdabWxzYkQwaUkzWm1abVptWmlJdlBqd3ZjM1puUGc9PSIsCiAgICAgICJzaXplcyI6ICIxMjJ4MTIyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROUlqVXhNaUlnZG1sbGQwSnZlRDBpTUNBd0lEVXhNaUExTVRJaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xtY3pMbTl5Wnk4eU1EQXdMM04yWnlJK1BHTnBjbU5zWlNCamVEMGlNalUySWlCamVUMGlNalUySWlCeVBTSXhOekVpSUdacGJHdzlJaU01TWpBMVFVWWlMejQ4Y0dGMGFDQmtQU0p0TVRjeExERXdOV0V4TmpBc01UWXdJREFnTUMweE5UUXVPVLLGJE5qVjBPV1poTVRZd0xERTJNQ0F3SURBc0xURXlPQzAwTWpoV05UQmhNVFl3TERFNE1DQXdJREFzTFRFek5DMHhNelJvTlRaa01WUXhORGhoTVRZd0xERTJNQ0F3SURBc0xURXpOQzB4TXpSNklpQm1hV3hzUFNKallUSTVOemNpTHo0OEwzTjJaejQ9IiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    
    <!-- iOS Specific PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="WordBank">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIyIiBoZWlnaHQ9IjEyMiIgdmlld0JveD0iMCAwIDEyMiAxMjIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNjEiIGN5PSI2MSIgcj0iNDEiIGZpbGw9IiM5MjA1QUYiLz48cGF0aCBkPSJtNDEsMjFhMjAsMjAgMCAwLTE0WDE0dDJ2YTIwLDIwIDAgMCwwLTE0YzAtMzMuMDEyLTI2Ljk4NC00OSA0OWEyN2EzMCwzMCAwIDAsLTE2LTE2djlhMTYsMTYgMCAwLC0xOC0xOFY0YTMwLDMwIDAgMCwwLTE2LTE2eiIgZmlsbD0iI2ZmZmZmZiIvPjwvc3ZnPg==">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Custom styles for better iOS experience */
        body {
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
        }
        
        .letter-btn {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        /* Hide address bar on iOS */
        @media screen and (max-height: 600px) {
            .min-h-screen {
                min-height: 100vh;
                min-height: -webkit-fill-available;
            }
        }
        
        /* Prevent zoom on input focus */
        input, select, textarea {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const WordBankGame = () => {
            // Letter frequency scoring (lower frequency = higher points)
            const letterScores = {
                'A': 1, 'E': 1, 'I': 1, 'O': 1, 'U': 1, 'R': 1, 'T': 1, 'L': 1, 'S': 1, 'N': 1,
                'C': 2, 'D': 2, 'P': 2, 'M': 2, 'H': 2, 'G': 2, 'B': 2, 'F': 2, 'Y': 2, 'W': 2,
                'K': 3, 'V': 3, 'X': 4, 'Z': 4, 'J': 4, 'Q': 5
            };

            // Valid 5-letter words - loaded from external file
            const [validWords, setValidWords] = useState([]);
            const [wordsLoaded, setWordsLoaded] = useState(false);

            // Load words from external file or use embedded fallback
            useEffect(() => {
                const loadWords = async () => {
                    try {
                        const response = await fetch('./words.txt');
                        const text = await response.text();
                        const words = text.split('\n')
                            .map(word => word.trim().toUpperCase())
                            .filter(word => word.length === 5);
                        
                        if (words.length > 100) {
                            setValidWords(words);
                            setWordsLoaded(true);
                            console.log(`Loaded ${words.length} words from words.txt`);
                            return;
                        }
                    } catch (error) {
                        console.error('Failed to load words.txt:', error);
                    }
                    
                    // Fallback to embedded word list
                    console.log('Using embedded word list');
                    const fallbackWords = [
                        'ABOUT', 'ABOVE', 'ABUSE', 'ACTOR', 'ACUTE', 'ADMIT', 'ADOPT', 'ADULT', 'AFTER', 'AGAIN',
                        'AGENT', 'AGREE', 'AHEAD', 'ALARM', 'ALBUM', 'ALERT', 'ALIEN', 'ALIGN', 'ALIKE', 'ALIVE',
                        'ALLOW', 'ALONE', 'ALONG', 'ALTER', 'ANGEL', 'ANGER', 'ANGLE', 'ANGRY', 'APART', 'APPLE',
                        'APPLY', 'ARENA', 'ARGUE', 'ARISE', 'ARRAY', 'ASIDE', 'ASSET', 'AWARD', 'AWARE', 'BADLY',
                        'BAKER', 'BASES', 'BASIC', 'BEACH', 'BEGAN', 'BEGIN', 'BEING', 'BELOW', 'BENCH', 'BILLY',
                        'BIRTH', 'BLACK', 'BLAME', 'BLANK', 'BLAST', 'BLIND', 'BLOCK', 'BLOOD', 'BOARD', 'BOOST',
                        'BOOTH', 'BOUND', 'BRAIN', 'BRAND', 'BRASS', 'BRAVE', 'BREAD', 'BREAK', 'BREED', 'BRIEF',
                        'BRING', 'BROAD', 'BROKE', 'BROWN', 'BUILD', 'BUYER', 'CABLE', 'CARRY', 'CATCH', 'CAUSE',
                        'CHAIN', 'CHAIR', 'CHAOS', 'CHARM', 'CHART', 'CHASE', 'CHEAP', 'CHECK', 'CHEST', 'CHIEF',
                        'CHILD', 'CHINA', 'CHOSE', 'CIVIL', 'CLAIM', 'CLASS', 'CLEAN', 'CLEAR', 'CLICK', 'CLIMB',
                        'CLOCK', 'CLOSE', 'CLOUD', 'COACH', 'COAST', 'COULD', 'COUNT', 'COURT', 'COVER', 'CRAFT',
                        'CRASH', 'CRAZY', 'CREAM', 'CRIME', 'CROSS', 'CROWD', 'CROWN', 'CRUDE', 'CURVE', 'CYCLE',
                        'DAILY', 'DANCE', 'DATED', 'DEALT', 'DEATH', 'DEBUT', 'DELAY', 'DEPTH', 'DOING', 'DOUBT',
                        'DOZEN', 'DRAFT', 'DRAMA', 'DRANK', 'DRAWN', 'DREAM', 'DRESS', 'DRILL', 'DRINK', 'DRIVE',
                        'DROVE', 'DYING', 'EAGER', 'EARLY', 'EARTH', 'EIGHT', 'ELITE', 'EMPTY', 'ENEMY', 'ENJOY',
                        'ENTER', 'ENTRY', 'EQUAL', 'ERROR', 'EVENT', 'EVERY', 'EXACT', 'EXIST', 'EXTRA', 'FAITH',
                        'FALSE', 'FAULT', 'FIBER', 'FIELD', 'FIFTH', 'FIFTY', 'FIGHT', 'FINAL', 'FIRST', 'FIXED',
                        'FLASH', 'FLEET', 'FLOOR', 'FLUID', 'FOCUS', 'FORCE', 'FORTH', 'FORTY', 'FORUM', 'FOUND',
                        'FRAME', 'FRANK', 'FRAUD', 'FRESH', 'FRONT', 'FRUIT', 'FULLY', 'FUNNY', 'GIANT', 'GIVEN',
                        'GLASS', 'GLOBE', 'GOING', 'GRACE', 'GRADE', 'GRAND', 'GRANT', 'GRASS', 'GRAVE', 'GREAT',
                        'GREEN', 'GROSS', 'GROUP', 'GROWN', 'GUARD', 'GUESS', 'GUEST', 'GUIDE', 'HAPPY', 'HEART',
                        'HEAVY', 'HENCE', 'HORSE', 'HOTEL', 'HOUSE', 'HUMAN', 'HURRY', 'IMAGE', 'INDEX', 'INNER',
                        'INPUT', 'ISSUE', 'JAPAN', 'JIMMY', 'JOINT', 'JONES', 'JUDGE', 'KNOWN', 'LABEL', 'LARGE',
                        'LASER', 'LATER', 'LAUGH', 'LAYER', 'LEARN', 'LEASE', 'LEAST', 'LEAVE', 'LEGAL', 'LEVEL',
                        'LIGHT', 'LIMIT', 'LINKS', 'LIVES', 'LOCAL', 'LOOSE', 'LOWER', 'LUCKY', 'LUNCH', 'LYING',
                        'MAGIC', 'MAJOR', 'MAKER', 'MARCH', 'MATCH', 'MAYBE', 'MAYOR', 'MEANT', 'MEDIA', 'METAL',
                        'MIGHT', 'MINOR', 'MINUS', 'MIXED', 'MODEL', 'MONEY', 'MONTH', 'MORAL', 'MOTOR', 'MOUNT',
                        'MOUSE', 'MOUTH', 'MOVED', 'MOVIE', 'MUSIC', 'NEEDS', 'NEVER', 'NEWLY', 'NIGHT', 'NOISE',
                        'NORTH', 'NOTED', 'NOVEL', 'NURSE', 'OCCUR', 'OCEAN', 'OFFER', 'OFTEN', 'ORDER', 'OTHER',
                        'OUGHT', 'PAINT', 'PANEL', 'PAPER', 'PARTY', 'PEACE', 'PETER', 'PHASE', 'PHONE', 'PHOTO',
                        'PIANO', 'PIECE', 'PILOT', 'PITCH', 'PLACE', 'PLAIN', 'PLANE', 'PLANT', 'PLATE', 'POINT',
                        'POUND', 'POWER', 'PRESS', 'PRICE', 'PRIDE', 'PRIME', 'PRINT', 'PRIOR', 'PRIZE', 'PROOF',
                        'PROUD', 'PROVE', 'QUEEN', 'QUICK', 'QUIET', 'QUITE', 'RADIO', 'RAISE', 'RANGE', 'RAPID',
                        'RATIO', 'REACH', 'READY', 'REALM', 'REBEL', 'REFER', 'RELAX', 'REPLY', 'RIGHT', 'RIVAL',
                        'RIVER', 'ROBIN', 'ROGER', 'ROMAN', 'ROUGH', 'ROUND', 'ROUTE', 'ROYAL', 'RURAL', 'SCALE',
                        'SCENE', 'SCOPE', 'SCORE', 'SENSE', 'SERVE', 'SEVEN', 'SHALL', 'SHAPE', 'SHARE', 'SHARP',
                        'SHEET', 'SHELF', 'SHELL', 'SHIFT', 'SHINE', 'SHIRT', 'SHOCK', 'SHOOT', 'SHORT', 'SHOWN',
                        'SIGHT', 'SILLY', 'SINCE', 'SIXTH', 'SIXTY', 'SIZED', 'SKILL', 'SLEEP', 'SLIDE', 'SMALL',
                        'SMART', 'SMILE', 'SMITH', 'SMOKE', 'SNAKE', 'SOLID', 'SOLVE', 'SORRY', 'SOUND', 'SOUTH',
                        'SPACE', 'SPARE', 'SPEAK', 'SPEED', 'SPEND', 'SPENT', 'SPLIT', 'SPOKE', 'SPORT', 'STAFF',
                        'STAGE', 'STAKE', 'STAND', 'START', 'STATE', 'STEAM', 'STEEL', 'STEEP', 'STEER', 'STICK',
                        'STILL', 'STOCK', 'STONE', 'STOOD', 'STORE', 'STORM', 'STORY', 'STRIP', 'STUCK', 'STUDY',
                        'STUFF', 'STYLE', 'SUGAR', 'SUITE', 'SUPER', 'SWEET', 'TABLE', 'TAKEN', 'TASTE', 'TAXES',
                        'TEACH', 'TEAMS', 'TEETH', 'TERRY', 'TEXAS', 'THANK', 'THEFT', 'THEIR', 'THEME', 'THERE',
                        'THESE', 'THICK', 'THING', 'THINK', 'THIRD', 'THOSE', 'THREE', 'THREW', 'THROW', 'THUMB',
                        'TIGER', 'TIGHT', 'TIMER', 'TIRED', 'TITLE', 'TODAY', 'TOPIC', 'TOTAL', 'TOUCH', 'TOUGH',
                        'TOWER', 'TRACK', 'TRADE', 'TRAIN', 'TREAT', 'TREND', 'TRIAL', 'TRIBE', 'TRICK', 'TRIED',
                        'TRIES', 'TRUCK', 'TRULY', 'TRUNK', 'TRUST', 'TRUTH', 'TWICE', 'TWIST', 'TYLER', 'ULTRA',
                        'UNCLE', 'UNDER', 'UNDUE', 'UNION', 'UNITY', 'UNTIL', 'UPPER', 'UPSET', 'URBAN', 'USAGE',
                        'USUAL', 'VALID', 'VALUE', 'VIDEO', 'VIRUS', 'VISIT', 'VITAL', 'VOCAL', 'VOICE', 'WASTE',
                        'WATCH', 'WATER', 'WHEEL', 'WHERE', 'WHICH', 'WHILE', 'WHITE', 'WHOLE', 'WHOSE', 'WOMAN',
                        'WOMEN', 'WORLD', 'WORRY', 'WORSE', 'WORST', 'WORTH', 'WOULD', 'WRITE', 'WRONG', 'WROTE',
                        'YOUNG', 'YOURS', 'YOUTH'
                    ];
                    setValidWords(fallbackWords);
                    setWordsLoaded(true);
                };
                loadWords();
            }, []);

            // Generate consistent daily letter bank for ALL users
            const generateDailyBank = () => {
                // Use a fixed epoch date to ensure consistency across all users
                const baseDate = new Date('2025-01-01');
                const today = new Date();
                today.setHours(0, 0, 0, 0); // Normalize to start of day
                
                // Calculate days since base date for seed
                const daysSinceBase = Math.floor((today - baseDate) / (1000 * 60 * 60 * 24));
                
                // Use a more sophisticated random number generator for better distribution
                const mulberry32 = (seed) => {
                    return function() {
                        let t = seed += 0x6D2B79F5;
                        t = Math.imul(t ^ t >>> 15, t | 1);
                        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                        return ((t ^ t >>> 14) >>> 0) / 4294967296;
                    }
                };
                
                const rng = mulberry32(daysSinceBase);
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                const bank = [];
                
                // Generate 15 letters with possibility of duplicates
                for (let i = 0; i < 15; i++) {
                    const index = Math.floor(rng() * letters.length);
                    bank.push(letters[index]);
                }
                
                return bank;
            };

            // Load saved data from localStorage
            const loadSavedData = () => {
                const today = new Date().toDateString();
                const saved = localStorage.getItem('wordBankGame');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.date === today) {
                        return data;
                    }
                }
                return null;
            };

            // Save data to localStorage
            const saveData = (data) => {
                const today = new Date().toDateString();
                localStorage.setItem('wordBankGame', JSON.stringify({
                    ...data,
                    date: today
                }));
            };

            const [letterBank, setLetterBank] = useState(() => {
                const saved = loadSavedData();
                return saved ? saved.letterBank : generateDailyBank();
            });
            
            const [currentWord, setCurrentWord] = useState('');
            const [foundWords, setFoundWords] = useState(() => {
                const saved = loadSavedData();
                return saved ? saved.foundWords : [];
            });
            
            const [totalScore, setTotalScore] = useState(() => {
                const saved = loadSavedData();
                return saved ? saved.totalScore : 0;
            });
            
            const [message, setMessage] = useState('');
            const [selectedLetters, setSelectedLetters] = useState([]);
            const [showInstallPrompt, setShowInstallPrompt] = useState(false);
            const [gameFinished, setGameFinished] = useState(() => {
                const saved = loadSavedData();
                return saved ? saved.gameFinished : false;
            });
            const [finalScore, setFinalScore] = useState(() => {
                const saved = loadSavedData();
                return saved ? saved.finalScore : 0;
            });
            const [timeLeft, setTimeLeft] = useState(() => {
                const saved = loadSavedData();
                return saved && saved.timeLeft !== undefined ? saved.timeLeft : 180; // 3 minutes = 180 seconds
            });
            const [gameStarted, setGameStarted] = useState(() => {
                const saved = loadSavedData();
                return saved ? saved.gameStarted : false;
            });
            const [timerActive, setTimerActive] = useState(false);

            // Save game state whenever it changes
            useEffect(() => {
                if (wordsLoaded) {
                    saveData({
                        letterBank,
                        foundWords,
                        totalScore,
                        gameFinished,
                        finalScore,
                        timeLeft,
                        gameStarted
                    });
                }
            }, [letterBank, foundWords, totalScore, gameFinished, finalScore, timeLeft, gameStarted, wordsLoaded]);

            // Timer effect
            useEffect(() => {
                let interval = null;
                
                if (timerActive && timeLeft > 0 && !gameFinished) {
                    interval = setInterval(() => {
                        setTimeLeft(prevTime => {
                            if (prevTime <= 1) {
                                // Time's up!
                                setGameFinished(true);
                                setFinalScore(totalScore);
                                setTimerActive(false);
                                setMessage(`Time's up! Final score: ${totalScore} points with ${foundWords.length} words found.`);
                                return 0;
                            }
                            return prevTime - 1;
                        });
                    }, 1000);
                }
                
                return () => {
                    if (interval) clearInterval(interval);
                };
            }, [timerActive, timeLeft, gameFinished, totalScore, foundWords.length]);

            // Start game timer when first word is attempted
            useEffect(() => {
                if (gameStarted && !timerActive && !gameFinished && timeLeft > 0) {
                    setTimerActive(true);
                }
            }, [gameStarted, timerActive, gameFinished, timeLeft]);

            // Install prompt for PWA
            useEffect(() => {
                let deferredPrompt;
                
                const handleBeforeInstallPrompt = (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    setShowInstallPrompt(true);
                };

                window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);

                return () => {
                    window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                };
            }, []);

            const calculateWordScore = (word) => {
                return word.split('').reduce((score, letter) => score + (letterScores[letter] || 1), 0);
            };

            const canFormWord = (word, bank) => {
                const bankCopy = [...bank];
                for (let letter of word) {
                    const index = bankCopy.indexOf(letter);
                    if (index === -1) return false;
                    bankCopy.splice(index, 1);
                }
                return true;
            };

            const handleLetterClick = (letter, index) => {
                if (gameFinished || timeLeft === 0) return;
                
                // Start the game timer on first interaction
                if (!gameStarted) {
                    setGameStarted(true);
                }
                
                if (currentWord.length < 5 && !selectedLetters.includes(index)) {
                    setCurrentWord(prev => prev + letter);
                    setSelectedLetters(prev => [...prev, index]);
                }
            };

            const clearWord = () => {
                if (gameFinished || timeLeft === 0) return;
                setCurrentWord('');
                setSelectedLetters([]);
            };

            const submitWord = () => {
                if (gameFinished || timeLeft === 0) return;
                
                // Start the game timer on first interaction
                if (!gameStarted) {
                    setGameStarted(true);
                }
                
                if (currentWord.length !== 5) {
                    setMessage('Word must be exactly 5 letters!');
                    setTimeout(() => setMessage(''), 3000);
                    return;
                }

                if (foundWords.includes(currentWord)) {
                    setMessage('Word already found!');
                    setTimeout(() => setMessage(''), 3000);
                    return;
                }

                if (!validWords.includes(currentWord)) {
                    setMessage('Not a valid word!');
                    setTimeout(() => setMessage(''), 3000);
                    return;
                }

                if (!canFormWord(currentWord, letterBank)) {
                    setMessage('Cannot form word with available letters!');
                    setTimeout(() => setMessage(''), 3000);
                    return;
                }

                const wordScore = calculateWordScore(currentWord);
                setFoundWords(prev => [...prev, currentWord]);
                setTotalScore(prev => prev + wordScore);
                setMessage(`Great! "${currentWord}" scores ${wordScore} points!`);
                setCurrentWord('');
                setSelectedLetters([]);
                setTimeout(() => setMessage(''), 3000);
            };

            const finishGame = () => {
                setGameFinished(true);
                setFinalScore(totalScore);
                setTimerActive(false);
                setMessage(`Game finished! Final score: ${totalScore} points with ${foundWords.length} words found.`);
            };

            const generateNewBank = () => {
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                const newBank = [];
                for (let i = 0; i < 15; i++) {
                    const randomIndex = Math.floor(Math.random() * letters.length);
                    newBank.push(letters[randomIndex]);
                }
                setLetterBank(newBank);
                setFoundWords([]);
                setTotalScore(0);
                setCurrentWord('');
                setSelectedLetters([]);
                setGameFinished(false);
                setFinalScore(0);
                setTimeLeft(180); // Reset to 3 minutes
                setGameStarted(false);
                setTimerActive(false);
                setMessage('Practice mode - no time limit!');
                setTimeout(() => setMessage(''), 3000);
            };

            // Format time as MM:SS
            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            // Get timer color based on time remaining
            const getTimerColor = () => {
                if (timeLeft > 60) return 'text-green-400';
                if (timeLeft > 30) return 'text-yellow-400';
                return 'text-red-400';
            };

            // Calculate possible words for hints
            const possibleWords = useMemo(() => {
                return validWords.filter(word => canFormWord(word, letterBank));
            }, [letterBank, validWords]);

            const StarIcon = () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26 12,2"></polygon>
                </svg>
            );

            const RefreshIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <polyline points="23,4 23,10 17,10"></polyline>
                    <polyline points="1,20 1,14 7,14"></polyline>
                    <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4L18.36,18.36A9,9,0,0,1,3.51,15"></path>
                </svg>
            );

            return React.createElement('div', {
                className: "min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4"
            }, 
                !wordsLoaded ? 
                    React.createElement('div', {
                        className: "max-w-md mx-auto bg-white/10 backdrop-blur-lg rounded-3xl p-6 shadow-2xl border border-white/20 flex items-center justify-center min-h-96"
                    },
                        React.createElement('div', { className: "text-center" },
                            React.createElement('div', { className: "animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4" }),
                            React.createElement('p', { className: "text-white" }, 'Loading word dictionary...')
                        )
                    )
                :
                React.createElement('div', {
                    className: "max-w-md mx-auto bg-white/10 backdrop-blur-lg rounded-3xl p-6 shadow-2xl border border-white/20"
                },
                    // Header
                    React.createElement('div', {
                        className: "text-center mb-6"
                    },
                        React.createElement('h1', {
                            className: "text-3xl font-bold text-white mb-2 flex items-center justify-center gap-2"
                        },
                            React.createElement(StarIcon, { className: "text-yellow-400" }),
                            'Word Bank'
                        ),
                        React.createElement('p', {
                            className: "text-purple-200 text-sm"
                        }, 'Create 5-letter words from your daily bank')
                    ),

                    // Score Display with Timer
                    React.createElement('div', {
                        className: "bg-white/20 rounded-2xl p-4 mb-6 text-center"
                    },
                        React.createElement('div', {
                            className: "flex justify-between items-center mb-3"
                        },
                            React.createElement('div', null,
                                React.createElement('p', { className: "text-white/80 text-sm" }, 'Score'),
                                React.createElement('p', { className: "text-2xl font-bold text-yellow-400" }, totalScore)
                            ),
                            React.createElement('div', null,
                                React.createElement('p', { className: "text-white/80 text-sm" }, 'Words Found'),
                                React.createElement('p', { className: "text-2xl font-bold text-green-400" }, foundWords.length)
                            ),
                            React.createElement('div', null,
                                React.createElement('p', { className: "text-white/80 text-sm" }, 'Possible'),
                                React.createElement('p', { className: "text-2xl font-bold text-blue-400" }, possibleWords.length)
                            )
                        ),
                        
                        // Timer Display
                        React.createElement('div', {
                            className: "border-t border-white/20 pt-3"
                        },
                            React.createElement('div', {
                                className: "flex items-center justify-center gap-2"
                            },
                                React.createElement('div', {
                                    className: "text-white/80 text-sm"
                                }, timeLeft > 0 && !gameStarted ? 'Time starts when you play' : 'Time Remaining'),
                                React.createElement('div', {
                                    className: `text-3xl font-bold ${getTimerColor()}`
                                }, formatTime(timeLeft))
                            ),
                            timeLeft <= 30 && timeLeft > 0 && timerActive && React.createElement('div', {
                                className: "text-red-300 text-xs mt-1 animate-pulse"
                            }, 'âš ï¸ Hurry up!')
                        )
                    ),

                    // Letter Bank
                    React.createElement('div', {
                        className: "mb-6"
                    },
                        React.createElement('h3', {
                            className: "text-white font-semibold mb-3 text-center"
                        }, 'Your Letter Bank'),
                        React.createElement('div', {
                            className: "grid grid-cols-5 gap-2"
                        },
                            letterBank.map((letter, index) =>
                                React.createElement('button', {
                                    key: index,
                                    onClick: () => handleLetterClick(letter, index),
                                    disabled: selectedLetters.includes(index),
                                    className: `
                                        letter-btn w-12 h-12 rounded-xl font-bold text-lg transition-all duration-200
                                        ${selectedLetters.includes(index) 
                                            ? 'bg-purple-600 text-white scale-95' 
                                            : 'bg-white/20 text-white hover:bg-white/30 hover:scale-105'
                                        }
                                        ${currentWord.length >= 5 && !selectedLetters.includes(index) ? 'opacity-50' : ''}
                                    `
                                },
                                    React.createElement('div', null, letter),
                                    React.createElement('div', {
                                        className: "text-xs text-yellow-300"
                                    }, letterScores[letter])
                                )
                            )
                        )
                    ),

                    // Game Finished Overlay
                    gameFinished && React.createElement('div', {
                        className: "bg-white/20 rounded-2xl p-6 mb-6 text-center border-2 border-yellow-400/50"
                    },
                        React.createElement('h2', {
                            className: "text-2xl font-bold text-yellow-400 mb-3"
                        }, timeLeft === 0 ? 'â° Time\'s Up!' : 'ðŸŽ‰ Game Complete!'),
                        React.createElement('div', {
                            className: "space-y-2 text-white"
                        },
                            React.createElement('p', { className: "text-lg" }, `Final Score: ${finalScore} points`),
                            React.createElement('p', null, `Words Found: ${foundWords.length} / ${possibleWords.length}`),
                            React.createElement('p', { className: "text-sm text-purple-200" }, timeLeft === 0 ? 
                                'Time ran out! Come back tomorrow for a new challenge!' : 
                                'Come back tomorrow for a new challenge!')
                        )
                    ),

                    // Current Word
                    React.createElement('div', {
                        className: "mb-6"
                    },
                        React.createElement('div', {
                            className: `bg-white/20 rounded-2xl p-4 ${gameFinished || timeLeft === 0 ? 'opacity-50' : ''}`
                        },
                            React.createElement('div', {
                                className: "flex justify-center gap-2 mb-4"
                            },
                                [...Array(5)].map((_, i) =>
                                    React.createElement('div', {
                                        key: i,
                                        className: "w-12 h-12 border-2 border-white/30 rounded-xl flex items-center justify-center text-white font-bold text-lg bg-white/10"
                                    }, currentWord[i] || '')
                                )
                            ),
                            
                            React.createElement('div', {
                                className: "flex gap-2 justify-center"
                            },
                                React.createElement('button', {
                                    onClick: clearWord,
                                    className: `px-4 py-2 bg-red-500/80 text-white rounded-xl hover:bg-red-600/80 transition-colors ${gameFinished || timeLeft === 0 ? 'opacity-50 cursor-not-allowed' : ''}`,
                                    disabled: currentWord.length === 0 || gameFinished || timeLeft === 0
                                }, 'Clear'),
                                React.createElement('button', {
                                    onClick: submitWord,
                                    className: `px-6 py-2 bg-green-500/80 text-white rounded-xl hover:bg-green-600/80 transition-colors font-semibold ${gameFinished || timeLeft === 0 ? 'opacity-50 cursor-not-allowed' : ''}`,
                                    disabled: currentWord.length !== 5 || gameFinished || timeLeft === 0
                                }, 'Submit'),
                                !gameFinished && timeLeft > 0 && React.createElement('button', {
                                    onClick: finishGame,
                                    className: "px-6 py-2 bg-yellow-500/80 text-white rounded-xl hover:bg-yellow-600/80 transition-colors font-semibold"
                                }, 'Finish')
                            )
                        ),
                        
                        message && React.createElement('p', {
                            className: `text-center mt-3 font-semibold ${
                                message.includes('Great!') || message.includes('Game finished!') || message.includes('Time\'s up!') ? 'text-green-300' : 'text-yellow-300'
                            }`
                        }, message)
                    ),

                    // Found Words
                    foundWords.length > 0 && React.createElement('div', {
                        className: "mb-6"
                    },
                        React.createElement('h3', {
                            className: "text-white font-semibold mb-3"
                        }, 'Found Words'),
                        React.createElement('div', {
                            className: "bg-white/10 rounded-2xl p-4 max-h-32 overflow-y-auto"
                        },
                            React.createElement('div', {
                                className: "grid grid-cols-2 gap-2"
                            },
                                foundWords.map((word, index) =>
                                    React.createElement('div', {
                                        key: index,
                                        className: "bg-white/20 rounded-lg p-2 text-center"
                                    },
                                        React.createElement('div', {
                                            className: "text-white font-semibold"
                                        }, word),
                                        React.createElement('div', {
                                            className: "text-yellow-300 text-xs"
                                        }, `${calculateWordScore(word)} pts`)
                                    )
                                )
                            )
                        )
                    ),

                    // New Bank Button (now "Practice Mode")
                    React.createElement('button', {
                        onClick: generateNewBank,
                        className: "w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-2xl font-semibold hover:from-purple-700 hover:to-blue-700 transition-all duration-200 flex items-center justify-center gap-2 mb-4"
                    },
                        React.createElement(RefreshIcon),
                        'Practice Mode (Random Bank)'
                    ),

                    // Install PWA Button (shows on compatible devices)
                    showInstallPrompt && React.createElement('button', {
                        onClick: () => {
                            if (window.deferredPrompt) {
                                window.deferredPrompt.prompt();
                                window.deferredPrompt.userChoice.then(() => {
                                    setShowInstallPrompt(false);
                                });
                            }
                        },
                        className: "w-full bg-gradient-to-r from-green-600 to-teal-600 text-white py-3 rounded-2xl font-semibold hover:from-green-700 hover:to-teal-700 transition-all duration-200 mb-4"
                    }, 'ðŸ“± Install App'),

                    // Letter Scoring Guide
                    React.createElement('div', {
                        className: "mt-6 bg-white/10 rounded-2xl p-4"
                    },
                        React.createElement('h4', {
                            className: "text-white font-semibold mb-2 text-center"
                        }, 'Letter Values'),
                        React.createElement('div', {
                            className: "grid grid-cols-3 gap-1 text-xs"
                        },
                            React.createElement('div', {
                                className: "text-center"
                            },
                                React.createElement('div', {
                                    className: "text-green-300 font-semibold"
                                }, '1 Point'),
                                React.createElement('div', {
                                    className: "text-white/80"
                                }, 'A E I O U R T L S N')
                            ),
                            React.createElement('div', {
                                className: "text-center"
                            },
                                React.createElement('div', {
                                    className: "text-yellow-300 font-semibold"
                                }, '2-3 Points'),
                                React.createElement('div', {
                                    className: "text-white/80"
                                }, 'C D P M H G B F Y W K V')
                            ),
                            React.createElement('div', {
                                className: "text-center"
                            },
                                React.createElement('div', {
                                    className: "text-red-300 font-semibold"
                                }, '4-5 Points'),
                                React.createElement('div', {
                                    className: "text-white/80"
                                }, 'X Z J Q')
                            )
                        )
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(WordBankGame), document.getElementById('app'));
    </script>

    <!-- Service Worker Registration -->
    <script>
        // Only register service worker in secure contexts (HTTPS or localhost)
        if ('serviceWorker' in navigator && (location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1')) {
            window.addEventListener('load', function() {
                try {
                    // Create service worker inline
                    const swCode = `
                        const CACHE_NAME = 'word-bank-game-v2';
                        const urlsToCache = [
                            '/',
                            '/index.html',
                            '/words.txt'
                        ];

                        self.addEventListener('install', function(event) {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then(function(cache) {
                                        return cache.addAll(urlsToCache);
                                    })
                            );
                        });

                        self.addEventListener('fetch', function(event) {
                            event.respondWith(
                                caches.match(event.request)
                                    .then(function(response) {
                                        if (response) {
                                            return response;
                                        }
                                        return fetch(event.request);
                                    }
                                )
                            );
                        });
                    `;

                    const blob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(blob);

                    navigator.serviceWorker.register(swUrl)
                        .then(function(registration) {
                            console.log('ServiceWorker registration successful');
                        })
                        .catch(function(err) {
                            console.log('ServiceWorker registration failed: ', err);
                        });
                } catch (error) {
                    console.log('Service Worker not supported in this context:', error);
                }
            });
        } else {
            console.log('Service Worker not available (requires HTTPS or localhost)');
        }

        // Handle install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            window.deferredPrompt = e;
        });
    </script>
</body>
</html>
