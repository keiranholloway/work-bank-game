<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Bank Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .score-display {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            text-align: center;
        }
        
        .score-item {
            flex: 1;
        }
        
        .score-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .timer {
            font-size: 2rem;
            font-weight: bold;
            color: #90EE90;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .letter-bank {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .letter-btn {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .letter-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .letter-btn:disabled {
            background: rgba(128, 0, 128, 0.6);
            transform: scale(0.95);
            cursor: not-allowed;
        }
        
        .letter-value {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 0.7rem;
            color: #ffd700;
        }
        
        .current-word {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .word-slot {
            width: 50px;
            height: 50px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn:hover:not(:disabled) {
            transform: scale(1.05);
        }
        
        .btn-clear {
            background: #ff6b6b;
            color: white;
        }
        
        .btn-clear:hover:not(:disabled) {
            background: #ff5252;
        }
        
        .btn-back {
            background: #ffa726;
            color: white;
        }
        
        .btn-back:hover:not(:disabled) {
            background: #ff9800;
        }
        
        .btn-submit {
            background: #4caf50;
            color: white;
        }
        
        .btn-submit:hover:not(:disabled) {
            background: #45a049;
        }
        
        .message {
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
            min-height: 25px;
            color: #ffd700;
        }
        
        .found-words {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .word-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .found-word {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .game-over {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff6b6b;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⭐ Word Bank</h1>
            <p>Create 5-letter words from your daily bank</p>
        </div>
        
        <div id="app">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading game...</p>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            validWords: [],
            letterBank: [],
            currentWord: '',
            selectedLetters: [],
            foundWords: [],
            totalScore: 0,
            timeLeft: 180,
            gameStarted: false,
            gameFinished: false,
            timerInterval: null
        };

        // Letter scores
        const letterScores = {
            'A': 1, 'E': 1, 'I': 1, 'O': 1, 'U': 1, 'R': 1, 'T': 1, 'L': 1, 'S': 1, 'N': 1,
            'C': 2, 'D': 2, 'P': 2, 'M': 2, 'H': 2, 'G': 2, 'B': 2, 'F': 2, 'Y': 2, 'W': 2,
            'K': 3, 'V': 3, 'X': 4, 'Z': 4, 'J': 4, 'Q': 5
        };

        // Generate daily letter bank
        function generateDailyBank() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const baseDate = new Date('2025-01-01');
            const daysSinceBase = Math.floor((today - baseDate) / (1000 * 60 * 60 * 24));
            
            // Better random number generator
            function mulberry32(a) {
                return function() {
                    let t = a += 0x6D2B79F5;
                    t = Math.imul(t ^ t >>> 15, t | 1);
                    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                    return ((t ^ t >>> 14) >>> 0) / 4294967296;
                }
            }
            
            const rng = mulberry32(daysSinceBase);
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const bank = [];
            
            for (let i = 0; i < 15; i++) {
                const index = Math.floor(rng() * letters.length);
                bank.push(letters[index]);
            }
            
            return bank;
        }

        // Load words from file
        async function loadWords() {
            try {
                console.log('Loading words.txt...');
                const response = await fetch('./words.txt');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                console.log('File loaded, parsing words...');
                
                if (!text || text.trim().length === 0) {
                    throw new Error('words.txt file is empty');
                }
                
                const words = text.split('\n')
                    .map(word => word.trim().toUpperCase())
                    .filter(word => word.length === 5 && /^[A-Z]+$/.test(word));
                
                if (words.length < 50) {
                    throw new Error(`Not enough valid words found (${words.length})`);
                }
                
                gameState.validWords = words;
                gameState.letterBank = generateDailyBank();
                console.log(`Successfully loaded ${words.length} words`);
                
                renderGame();
            } catch (error) {
                console.error('Error loading words:', error);
                document.getElementById('app').innerHTML = `
                    <div class="error">
                        <h2>❌ Error Loading Game</h2>
                        <p><strong>Problem:</strong> ${error.message}</p>
                        <p>Make sure <code>words.txt</code> exists in your repository.</p>
                        <button class="btn btn-submit" onclick="location.reload()">Try Again</button>
                    </div>
                `;
            }
        }

        // Calculate possible words
        function getPossibleWords() {
            if (!gameState.validWords || !gameState.letterBank) {
                return [];
            }
            return gameState.validWords.filter(word => canFormWord(word, gameState.letterBank));
        }

        // Check if word can be formed
        function canFormWord(word, bank) {
            if (!word || !bank) return false;
            const bankCopy = [...bank];
            for (let letter of word) {
                const index = bankCopy.indexOf(letter);
                if (index === -1) return false;
                bankCopy.splice(index, 1);
            }
            return true;
        }

        // Calculate word score
        function calculateWordScore(word) {
            if (!word) return 0;
            return word.split('').reduce((score, letter) => score + (letterScores[letter] || 1), 0);
        }

        // Format time
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Handle letter click
        function selectLetter(letter, index) {
            if (gameState.gameFinished || gameState.timeLeft === 0) return;
            if (gameState.currentWord.length >= 5 || gameState.selectedLetters.includes(index)) return;
            
            if (!gameState.gameStarted) {
                gameState.gameStarted = true;
                startTimer();
            }
            
            gameState.currentWord += letter;
            gameState.selectedLetters.push(index);
            renderGame();
        }

        // Clear word
        function clearWord() {
            if (gameState.gameFinished || gameState.timeLeft === 0) return;
            gameState.currentWord = '';
            gameState.selectedLetters = [];
            renderGame();
        }

        // Backspace
        function backspaceWord() {
            if (gameState.gameFinished || gameState.timeLeft === 0) return;
            if (gameState.currentWord.length === 0) return;
            
            gameState.currentWord = gameState.currentWord.slice(0, -1);
            gameState.selectedLetters.pop();
            renderGame();
        }

        // Submit word
        function submitWord() {
            if (gameState.gameFinished || gameState.timeLeft === 0) return;
            if (gameState.currentWord.length !== 5) {
                showMessage('Word must be exactly 5 letters!');
                return;
            }
            
            if (!gameState.gameStarted) {
                gameState.gameStarted = true;
                startTimer();
            }
            
            if (gameState.foundWords.includes(gameState.currentWord)) {
                showMessage('Word already found!');
                return;
            }
            
            if (!gameState.validWords.includes(gameState.currentWord)) {
                showMessage('Not a valid word!');
                return;
            }
            
            if (!canFormWord(gameState.currentWord, gameState.letterBank)) {
                showMessage('Cannot form word with available letters!');
                return;
            }
            
            const wordScore = calculateWordScore(gameState.currentWord);
            gameState.foundWords.push(gameState.currentWord);
            gameState.totalScore += wordScore;
            showMessage(`Great! "${gameState.currentWord}" scores ${wordScore} points!`);
            
            gameState.currentWord = '';
            gameState.selectedLetters = [];
            
            // Check if all words found
            const possibleWords = getPossibleWords();
            if (gameState.foundWords.length === possibleWords.length) {
                endGame('🎉 Perfect! You found all words!');
            }
            
            renderGame();
        }

        // Start timer
        function startTimer() {
            if (gameState.timerInterval) return;
            
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timerInterval);
                    endGame("⏰ Time's up!");
                }
                
                renderGame();
            }, 1000);
        }

        // End game
        function endGame(message) {
            gameState.gameFinished = true;
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
            }
            showMessage(message);
            renderGame();
        }

        // Show message
        function showMessage(text) {
            const messageEl = document.querySelector('.message');
            if (messageEl) {
                messageEl.textContent = text;
                setTimeout(() => {
                    if (messageEl && messageEl.textContent === text) {
                        messageEl.textContent = '';
                    }
                }, 3000);
            }
        }

        // Render game
        function renderGame() {
            const possibleWords = getPossibleWords();
            const timerColor = gameState.timeLeft > 60 ? '#90EE90' : gameState.timeLeft > 30 ? '#ffd700' : '#ff6b6b';
            
            document.getElementById('app').innerHTML = `
                <!-- Score Display -->
                <div class="score-display">
                    <div class="score-item">
                        <div>Score</div>
                        <div class="score-value">${gameState.totalScore}</div>
                    </div>
                    <div class="score-item">
                        <div>Found</div>
                        <div class="score-value">${gameState.foundWords.length}</div>
                    </div>
                    <div class="score-item">
                        <div>Possible</div>
                        <div class="score-value">${possibleWords.length}</div>
                    </div>
                </div>

                <!-- Timer -->
                <div class="timer" style="color: ${timerColor}">
                    ${gameState.timeLeft > 0 && !gameState.gameStarted ? 'Ready? 🎯' : formatTime(gameState.timeLeft)}
                </div>

                <!-- Letter Bank -->
                <div class="letter-bank">
                    ${gameState.letterBank.map((letter, index) => `
                        <button class="letter-btn" 
                                onclick="selectLetter('${letter}', ${index})"
                                ${gameState.selectedLetters.includes(index) || gameState.gameFinished || gameState.timeLeft === 0 ? 'disabled' : ''}>
                            ${letter}
                            <div class="letter-value">${letterScores[letter]}</div>
                        </button>
                    `).join('')}
                </div>

                ${gameState.gameFinished ? `
                    <div class="game-over">
                        <h2>${gameState.foundWords.length === possibleWords.length ? '🏆 Perfect Game!' : '🎉 Game Complete!'}</h2>
                        <p><strong>Final Score:</strong> ${gameState.totalScore} points</p>
                        <p><strong>Words Found:</strong> ${gameState.foundWords.length}/${possibleWords.length}</p>
                        ${gameState.foundWords.length === possibleWords.length ? 
                            '<p style="color: #ffd700; margin-top: 10px;">🌟 You found every possible word! 🌟</p>' : ''}
                    </div>
                ` : ''}

                <!-- Current Word -->
                <div class="current-word">
                    ${[...Array(5)].map((_, i) => `
                        <div class="word-slot">${gameState.currentWord[i] || ''}</div>
                    `).join('')}
                </div>

                <!-- Controls -->
                <div class="controls">
                    <button class="btn btn-clear" 
                            onclick="clearWord()"
                            ${gameState.currentWord.length === 0 || gameState.gameFinished || gameState.timeLeft === 0 ? 'disabled' : ''}>
                        Clear
                    </button>
                    <button class="btn btn-back"
                            onclick="backspaceWord()"
                            ${gameState.currentWord.length === 0 || gameState.gameFinished || gameState.timeLeft === 0 ? 'disabled' : ''}>
                        ← Back
                    </button>
                    <button class="btn btn-submit"
                            onclick="submitWord()"
                            ${gameState.currentWord.length !== 5 || gameState.gameFinished || gameState.timeLeft === 0 ? 'disabled' : ''}>
                        Submit
                    </button>
                </div>

                <!-- Message -->
                <div class="message"></div>

                <!-- Found Words -->
                ${gameState.foundWords.length > 0 ? `
                    <div class="found-words">
                        <h3 style="margin-bottom: 15px;">Found Words (${gameState.foundWords.length})</h3>
                        <div class="word-grid">
                            ${gameState.foundWords.map(word => `
                                <div class="found-word">
                                    <div style="font-weight: bold;">${word}</div>
                                    <div style="color: #ffd700; font-size: 0.8rem;">${calculateWordScore(word)} pts</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
        }

        // Initialize game
        console.log('Starting Word Bank Game...');
        loadWords();
    </script>
</body>
</html>
